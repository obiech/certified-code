{"ast":null,"code":"import { __assign, __awaiter, __generator } from \"tslib\";\nimport { get, each } from '@antv/util';\nimport { intersect } from '../../../util/collision-detect';\nimport { getLabelBackgroundInfo } from '../util';\nimport { createWorker } from '../util/createWorker';\nimport { code as layoutCode } from './worker/hide-overlap';\nvar layout = function (items) {\n  var boxes = items.slice();\n  for (var i = 0; i < boxes.length; i++) {\n    var box1 = boxes[i];\n    if (box1.visible) {\n      for (var j = i + 1; j < boxes.length; j++) {\n        var box2 = boxes[j];\n        if (box1 !== box2 && box2.visible) {\n          if (intersect(box1, box2)) {\n            box2.visible = false;\n          }\n        }\n      }\n    }\n  }\n  return boxes;\n};\nvar cache = new Map();\nvar worker = createWorker(layoutCode);\n/**\n * label 防遮挡布局：在不改变 label 位置的情况下对相互重叠的 label 进行隐藏（非移除）\n * 不同于 'overlap' 类型的布局，该布局不会对 label 的位置进行偏移调整。\n * @param labels 参与布局调整的 label 数组集合\n */\nexport function hideOverlap(labelItems, labels, shapes, region) {\n  return __awaiter(this, void 0, void 0, function () {\n    var boxes, memoKey, cb, params, res, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          boxes = labels.map(function (d, idx) {\n            return __assign(__assign({}, getLabelBackgroundInfo(d, labelItems[idx], get(labelItems[idx], 'background.padding'))), {\n              visible: true\n            });\n          });\n          memoKey = JSON.stringify(boxes);\n          cb = function (items) {\n            cache.set(memoKey, items);\n            each(items, function (_a, idx) {\n              var visible = _a.visible;\n              var labelShape = labels[idx];\n              if (visible) {\n                labelShape === null || labelShape === void 0 ? void 0 : labelShape.show();\n              } else {\n                labelShape === null || labelShape === void 0 ? void 0 : labelShape.hide();\n              }\n            });\n            return items;\n          };\n          if (!cache.get(memoKey)) return [3 /*break*/, 1];\n          cb(cache.get(memoKey));\n          return [3 /*break*/, 7];\n        case 1:\n          if (!worker) return [3 /*break*/, 6];\n          _a.label = 2;\n        case 2:\n          _a.trys.push([2, 4,, 5]);\n          params = JSON.stringify({\n            type: 'hide-overlap',\n            items: boxes\n          });\n          return [4 /*yield*/, worker.post(params, function () {\n            return cb(layout(boxes));\n          })];\n        case 3:\n          res = _a.sent();\n          cb(Array.isArray(res.data) ? res.data : []);\n          return [3 /*break*/, 5];\n        case 4:\n          e_1 = _a.sent();\n          console.error(e_1);\n          cb(layout(boxes));\n          return [3 /*break*/, 5];\n        case 5:\n          return [3 /*break*/, 7];\n        case 6:\n          // Normal layout in main thread.\n          cb(layout(boxes));\n          _a.label = 7;\n        case 7:\n          return [2 /*return*/];\n      }\n    });\n  });\n}","map":{"version":3,"names":["__assign","__awaiter","__generator","get","each","intersect","getLabelBackgroundInfo","createWorker","code","layoutCode","layout","items","boxes","slice","i","length","box1","visible","j","box2","cache","Map","worker","hideOverlap","labelItems","labels","shapes","region","memoKey","cb","params","res","e_1","_a","label","map","d","idx","JSON","stringify","set","labelShape","show","hide","trys","push","type","post","sent","Array","isArray","data","console","error"],"sources":["/Users/obiechina/Documents/ridy-flutter-full-taxi-solution 2/node_modules/@antv/g2/esm/geometry/label/layout/hide-overlap.js"],"sourcesContent":["import { __assign, __awaiter, __generator } from \"tslib\";\nimport { get, each } from '@antv/util';\nimport { intersect } from '../../../util/collision-detect';\nimport { getLabelBackgroundInfo } from '../util';\nimport { createWorker } from '../util/createWorker';\nimport { code as layoutCode } from './worker/hide-overlap';\nvar layout = function (items) {\n    var boxes = items.slice();\n    for (var i = 0; i < boxes.length; i++) {\n        var box1 = boxes[i];\n        if (box1.visible) {\n            for (var j = i + 1; j < boxes.length; j++) {\n                var box2 = boxes[j];\n                if (box1 !== box2 && box2.visible) {\n                    if (intersect(box1, box2)) {\n                        box2.visible = false;\n                    }\n                }\n            }\n        }\n    }\n    return boxes;\n};\nvar cache = new Map();\nvar worker = createWorker(layoutCode);\n/**\n * label 防遮挡布局：在不改变 label 位置的情况下对相互重叠的 label 进行隐藏（非移除）\n * 不同于 'overlap' 类型的布局，该布局不会对 label 的位置进行偏移调整。\n * @param labels 参与布局调整的 label 数组集合\n */\nexport function hideOverlap(labelItems, labels, shapes, region) {\n    return __awaiter(this, void 0, void 0, function () {\n        var boxes, memoKey, cb, params, res, e_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    boxes = labels.map(function (d, idx) { return (__assign(__assign({}, getLabelBackgroundInfo(d, labelItems[idx], get(labelItems[idx], 'background.padding'))), { visible: true })); });\n                    memoKey = JSON.stringify(boxes);\n                    cb = function (items) {\n                        cache.set(memoKey, items);\n                        each(items, function (_a, idx) {\n                            var visible = _a.visible;\n                            var labelShape = labels[idx];\n                            if (visible) {\n                                labelShape === null || labelShape === void 0 ? void 0 : labelShape.show();\n                            }\n                            else {\n                                labelShape === null || labelShape === void 0 ? void 0 : labelShape.hide();\n                            }\n                        });\n                        return items;\n                    };\n                    if (!cache.get(memoKey)) return [3 /*break*/, 1];\n                    cb(cache.get(memoKey));\n                    return [3 /*break*/, 7];\n                case 1:\n                    if (!worker) return [3 /*break*/, 6];\n                    _a.label = 2;\n                case 2:\n                    _a.trys.push([2, 4, , 5]);\n                    params = JSON.stringify({ type: 'hide-overlap', items: boxes });\n                    return [4 /*yield*/, worker.post(params, function () { return cb(layout(boxes)); })];\n                case 3:\n                    res = _a.sent();\n                    cb(Array.isArray(res.data) ? res.data : []);\n                    return [3 /*break*/, 5];\n                case 4:\n                    e_1 = _a.sent();\n                    console.error(e_1);\n                    cb(layout(boxes));\n                    return [3 /*break*/, 5];\n                case 5: return [3 /*break*/, 7];\n                case 6:\n                    // Normal layout in main thread.\n                    cb(layout(boxes));\n                    _a.label = 7;\n                case 7: return [2 /*return*/];\n            }\n        });\n    });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}