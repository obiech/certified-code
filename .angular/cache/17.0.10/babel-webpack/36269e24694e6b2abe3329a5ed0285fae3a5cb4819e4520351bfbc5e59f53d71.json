{"ast":null,"code":"import _asyncToGenerator from \"/Users/obiechina/Documents/ridy-flutter-full-taxi-solution 2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { CreateOrderGQL } from '@ridy/admin-panel/generated/graphql';\nimport { firstValueFrom, map } from 'rxjs';\nimport { DispatcherService } from '../dispatcher.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../dispatcher.service\";\nimport * as i3 from \"@ridy/admin-panel/generated/graphql\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"ng-zorro-antd/date-picker\";\nimport * as i7 from \"ng-zorro-antd/list\";\nimport * as i8 from \"@ngx-translate/core\";\nfunction DispatcherServiceSelectComponent_ul_4_div_4_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 7)(1, \"ul\", 8)(2, \"nz-list-item-action\")(3, \"a\", 9);\n    i0.ɵɵlistener(\"click\", function DispatcherServiceSelectComponent_ul_4_div_4_li_1_Template_a_click_3_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const service_r5 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r6.selectService(service_r5));\n    });\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"currency\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const service_r5 = ctx.$implicit;\n    const fare_r1 = i0.ɵɵnextContext(2).ngIf;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(5, 3, \"profile.select\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", service_r5.name, \" (\", i0.ɵɵpipeBind2(7, 5, service_r5.cost, fare_r1.currency), \") \");\n  }\n}\nfunction DispatcherServiceSelectComponent_ul_4_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, DispatcherServiceSelectComponent_ul_4_div_4_li_1_Template, 8, 8, \"li\", 6);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const category_r3 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", category_r3.services);\n  }\n}\nfunction DispatcherServiceSelectComponent_ul_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 4)(1, \"nz-list-header\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, DispatcherServiceSelectComponent_ul_4_div_4_Template, 2, 1, \"div\", 5);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const fare_r1 = ctx.ngIf;\n    i0.ɵɵproperty(\"nzDataSource\", fare_r1.services);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 3, \"profile.services\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", fare_r1.services);\n  }\n}\nexport class DispatcherServiceSelectComponent {\n  constructor(route, router, dispatcherService, createOrderMutation) {\n    this.route = route;\n    this.router = router;\n    this.dispatcherService = dispatcherService;\n    this.createOrderMutation = createOrderMutation;\n    this.time = new Date();\n  }\n  ngOnInit() {\n    this.query = this.route.data.pipe(map(data => data.services));\n  }\n  selectService(service) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const riderId = _this.route.snapshot.queryParams.riderId;\n      const points = _this.dispatcherService.deserializePoints(_this.route.snapshot.queryParams.points);\n      var diff = (new Date().getTime() - _this.time.getTime()) / 1000 / 60;\n      diff = Math.abs(Math.round(diff));\n      const result = yield firstValueFrom(_this.createOrderMutation.mutate({\n        riderId,\n        points: points.map(point => point.location),\n        addresses: points.map(point => point.address),\n        serviceId: service.id,\n        intervalMinutes: diff > 0 ? diff : 0\n      }));\n      _this.router.navigate(['../looking'], {\n        relativeTo: _this.route,\n        queryParams: {\n          requestId: result.data?.createOrder.id,\n          points: undefined,\n          riderId: undefined\n        }\n      });\n    })();\n  }\n  static {\n    this.ɵfac = function DispatcherServiceSelectComponent_Factory(t) {\n      return new (t || DispatcherServiceSelectComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.DispatcherService), i0.ɵɵdirectiveInject(i3.CreateOrderGQL));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: DispatcherServiceSelectComponent,\n      selectors: [[\"app-dispatcher-service-select\"]],\n      decls: 6,\n      vars: 5,\n      consts: [[1, \"flex\", \"flex-col\", \"gap-4\"], [1, \"\"], [\"nzFormat\", \"MM/dd/yyyy hh:mm\", 3, \"ngModel\", \"nzShowTime\", \"ngModelChange\"], [\"nz-list\", \"\", \"nzBordered\", \"\", \"nzSize\", \"large\", 3, \"nzDataSource\", 4, \"ngIf\"], [\"nz-list\", \"\", \"nzBordered\", \"\", \"nzSize\", \"large\", 3, \"nzDataSource\"], [4, \"ngFor\", \"ngForOf\"], [\"nz-list-item\", \"\", \"nzNoFlex\", \"\", 4, \"ngFor\", \"ngForOf\"], [\"nz-list-item\", \"\", \"nzNoFlex\", \"\"], [\"nz-list-item-actions\", \"\"], [3, \"click\"]],\n      template: function DispatcherServiceSelectComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h5\", 1);\n          i0.ɵɵtext(2, \"Time\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"nz-date-picker\", 2);\n          i0.ɵɵlistener(\"ngModelChange\", function DispatcherServiceSelectComponent_Template_nz_date_picker_ngModelChange_3_listener($event) {\n            return ctx.time = $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(4, DispatcherServiceSelectComponent_ul_4_Template, 5, 5, \"ul\", 3);\n          i0.ɵɵpipe(5, \"async\");\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          let tmp_2_0;\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngModel\", ctx.time)(\"nzShowTime\", true);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", (tmp_2_0 = i0.ɵɵpipeBind1(5, 3, ctx.query)) == null ? null : tmp_2_0.data == null ? null : tmp_2_0.data.calculateFare);\n        }\n      },\n      dependencies: [i4.NgForOf, i4.NgIf, i5.NgControlStatus, i5.NgModel, i6.NzDatePickerComponent, i7.NzListComponent, i7.NzListHeaderComponent, i7.NzListItemComponent, i7.NzListItemActionsComponent, i7.NzListItemActionComponent, i4.AsyncPipe, i4.CurrencyPipe, i8.TranslatePipe],\n      encapsulation: 2\n    });\n  }\n}","map":{"version":3,"names":["ActivatedRoute","Router","CreateOrderGQL","firstValueFrom","map","DispatcherService","i0","ɵɵelementStart","ɵɵlistener","DispatcherServiceSelectComponent_ul_4_div_4_li_1_Template_a_click_3_listener","restoredCtx","ɵɵrestoreView","_r7","service_r5","$implicit","ctx_r6","ɵɵnextContext","ɵɵresetView","selectService","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate","ɵɵpipeBind1","ɵɵtextInterpolate2","name","ɵɵpipeBind2","cost","fare_r1","currency","ɵɵtemplate","DispatcherServiceSelectComponent_ul_4_div_4_li_1_Template","ɵɵproperty","category_r3","services","DispatcherServiceSelectComponent_ul_4_div_4_Template","DispatcherServiceSelectComponent","constructor","route","router","dispatcherService","createOrderMutation","time","Date","ngOnInit","query","data","pipe","service","_this","_asyncToGenerator","riderId","snapshot","queryParams","points","deserializePoints","diff","getTime","Math","abs","round","result","mutate","point","location","addresses","address","serviceId","id","intervalMinutes","navigate","relativeTo","requestId","createOrder","undefined","ɵɵdirectiveInject","i1","i2","i3","selectors","decls","vars","consts","template","DispatcherServiceSelectComponent_Template","rf","ctx","DispatcherServiceSelectComponent_Template_nz_date_picker_ngModelChange_3_listener","$event","DispatcherServiceSelectComponent_ul_4_Template","tmp_2_0","calculateFare"],"sources":["/Users/obiechina/Documents/ridy-flutter-full-taxi-solution 2/apps/admin-panel/src/app/cms/home/dispatcher/dispatcher-service-select/dispatcher-service-select.component.ts","/Users/obiechina/Documents/ridy-flutter-full-taxi-solution 2/apps/admin-panel/src/app/cms/home/dispatcher/dispatcher-service-select/dispatcher-service-select.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { ApolloQueryResult } from '@apollo/client/core';\nimport {\n  CreateOrderGQL,\n  DispatcherCalculateFareQuery,\n} from '@ridy/admin-panel/generated/graphql';\nimport { firstValueFrom, map, Observable } from 'rxjs';\nimport { DispatcherService } from '../dispatcher.service';\n\n@Component({\n  selector: 'app-dispatcher-service-select',\n  templateUrl: './dispatcher-service-select.component.html',\n  styles: [],\n})\nexport class DispatcherServiceSelectComponent implements OnInit {\n  query?: Observable<ApolloQueryResult<DispatcherCalculateFareQuery>>;\n  time: Date = new Date();\n\n  constructor(\n    private route: ActivatedRoute,\n    private router: Router,\n    private dispatcherService: DispatcherService,\n    private createOrderMutation: CreateOrderGQL,\n  ) {}\n\n  ngOnInit(): void {\n    this.query = this.route.data.pipe(map((data) => data.services));\n  }\n\n  async selectService(service: { id: string }) {\n    const riderId = this.route.snapshot.queryParams.riderId;\n    const points = this.dispatcherService.deserializePoints(\n      this.route.snapshot.queryParams.points,\n    );\n    var diff = (new Date().getTime() - this.time.getTime()) / 1000 / 60;\n    diff = Math.abs(Math.round(diff));\n    const result = await firstValueFrom(\n      this.createOrderMutation.mutate({\n        riderId,\n        points: points.map((point) => point.location),\n        addresses: points.map((point) => point.address),\n        serviceId: service.id,\n        intervalMinutes: diff > 0 ? diff : 0,\n      }),\n    );\n\n    this.router.navigate(['../looking'], {\n      relativeTo: this.route,\n      queryParams: {\n        requestId: result.data?.createOrder.id,\n        points: undefined,\n        riderId: undefined,\n      },\n    });\n  }\n}\n","<div class=\"flex flex-col gap-4\">\n  <h5 class=\"\">Time</h5>\n  <nz-date-picker [(ngModel)]=\"time\" [nzShowTime]=\"true\" nzFormat=\"MM/dd/yyyy hh:mm\"></nz-date-picker>\n  <ul nz-list *ngIf=\"(query | async)?.data?.calculateFare as fare\" [nzDataSource]=\"fare.services\" nzBordered\n    nzSize=\"large\">\n    <nz-list-header>{{'profile.services' | translate }}</nz-list-header>\n    <div *ngFor=\"let category of fare.services\">\n      <li nz-list-item *ngFor=\"let service of category.services\" nzNoFlex>\n        <ul nz-list-item-actions>\n          <nz-list-item-action>\n            <a (click)=\"selectService(service)\">{{ 'profile.select' | translate }}</a>\n          </nz-list-item-action>\n        </ul>\n        {{service.name}} ({{service.cost | currency: fare.currency}})\n      </li>\n    </div>\n  </ul>\n</div>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}